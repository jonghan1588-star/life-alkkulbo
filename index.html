<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3932359368392333"
     crossorigin="anonymous"></script>
<title>ì¸ìƒê¸ˆìœµì§„ë‹¨ê¸°</title>

<style>
*{box-sizing:border-box}
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --line:#e5e7eb;
  --accent:#2563eb;
  --good:#16a34a;
  --warn:#f59e0b;
  --bad:#dc2626;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Malgun Gothic",sans-serif;
  background:var(--bg);
  color:var(--text);
}

.app{
  max-width:430px;
  margin:0 auto;
  min-height:100vh;
  background:var(--bg);
}

.app-header{
  position:sticky;
  top:0;
  z-index:1000;
  background:#ffffffee;
  backdrop-filter: blur(8px);
  border-bottom:1px solid var(--line);
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}
.app-header .title{
  font-weight:900;
  font-size:16px;
  flex:1;
}
.header-buttons{
  display:flex;
  gap:6px;
}
.header-btn{
  font-size:12px;
  font-weight:900;
  border-radius:10px;
  padding:8px 12px;
  border:1px solid var(--line);
  background:#f1f5f9;
  cursor:pointer;
  white-space:nowrap;
}
.header-btn:active{
  transform:scale(0.95);
}

.progress-bar{
  background:#e5e7eb;
  height:4px;
  position:relative;
}
.progress-fill{
  background:var(--accent);
  height:100%;
  transition:width 0.3s;
}

#alkLife{
  min-height:100vh;
  max-width:480px;
  margin:0 auto;
  background:#ffffff;
}
.screen{display:none;min-height:100vh;padding:20px 16px 120px}
.screen.active{display:block}
h1{font-size:22px;margin:0 0 10px}
h2{font-size:18px;margin:0 0 8px}
h3{font-size:16px;margin:0 0 8px}
p{font-size:14px;line-height:1.6;color:var(--muted);margin:0 0 10px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}
.field{margin-bottom:12px;position:relative}
.field label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
.field input,.field select{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#fff;
  color:var(--text);
  font-size:16px;
  outline:none;
}
.field input:focus, .field select:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(37,99,235,0.1);
}
.field-hint{
  font-size:12px;
  color:var(--accent);
  margin-top:4px;
  font-weight:700;
}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:520px){.row2{grid-template-columns:1fr}}
.bottom-bar{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:0;
  width:100%;
  max-width:430px;
  background:#ffffffee;
  border-top:1px solid var(--line);
  padding:12px;
  z-index:999;
}
.btn{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:900;
  background:var(--accent);
  color:white;
  cursor:pointer;
  transition:all 0.2s;
}
.btn:active{transform:scale(0.98)}
.btn.secondary{
  background:#f1f5f9;
  color:var(--text);
  border:1px solid var(--line);
}
.btn.small{padding:10px 14px;font-size:14px}
.small{font-size:12px;color:var(--muted);line-height:1.55}
.big{font-size:20px;font-weight:950;line-height:1.25}
.result-card{
  border:1px solid var(--line);
  border-radius:14px;
  padding:14px;
  margin-bottom:10px;
  background:#fff;
}
.result-card.best{
  border-color:rgba(22,163,74,.55);
  background:#f0fdf4;
}
.notice{
  border:1px solid rgba(245,158,11,.35);
  background:#fffbeb;
  padding:12px;
  border-radius:14px;
  font-size:14px;
  line-height:1.6;
}
.danger{
  border:1px solid rgba(220,38,38,.25);
  background:#fef2f2;
  padding:12px;
  border-radius:14px;
  font-size:14px;
  line-height:1.6;
}
.info{
  border:1px solid rgba(37,99,235,.25);
  background:#eff6ff;
  padding:12px;
  border-radius:14px;
  font-size:14px;
  line-height:1.6;
}
.chipgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:520px){.chipgrid{grid-template-columns:1fr}}
.chip{
  padding:14px;
  border-radius:14px;
  border:1px solid var(--line);
  background:#fff;
  cursor:pointer;
  font-weight:900;
  transition:all 0.2s;
}
.chip:hover{border-color:var(--accent);background:#eff6ff}
.chip.active{border-color:var(--accent);background:#eff6ff;border-width:2px}
.chip small{display:block;color:var(--muted);font-weight:700;margin-top:6px;line-height:1.3}

.custom-region{
  display:none;
  margin-top:12px;
  padding:14px;
  background:#f8fafc;
  border-radius:12px;
}
.custom-region.active{display:block}

.comparison-tabs{
  display:flex;
  gap:8px;
  margin-bottom:12px;
  overflow-x:auto;
}
.tab{
  padding:10px 16px;
  border-radius:10px;
  border:1px solid var(--line);
  background:#fff;
  cursor:pointer;
  font-size:13px;
  font-weight:900;
  white-space:nowrap;
  transition:all 0.2s;
}
.tab.active{
  background:var(--accent);
  color:white;
  border-color:var(--accent);
}

.bottleneck-list{
  list-style:none;
  padding:0;
  margin:10px 0;
}
.bottleneck-list li{
  padding:10px;
  margin:6px 0;
  border-radius:10px;
  background:#f8fafc;
  border-left:4px solid var(--line);
}
.bottleneck-list li.high{border-left-color:var(--bad)}
.bottleneck-list li.med{border-left-color:var(--warn)}
.bottleneck-list li.low{border-left-color:var(--good)}

.event-selector{
  margin-top:12px;
  padding:14px;
  background:#f8fafc;
  border-radius:12px;
}

canvas{max-width:100%;height:auto}
hr{border:none;border-top:1px solid var(--line);margin:12px 0}

.cta-box{
  border:1px dashed rgba(100,116,139,.35);
  border-radius:14px;
  padding:14px;
  text-align:center;
  background:#fff;
}

.highlight-box{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color:white;
  padding:16px;
  border-radius:14px;
  margin:12px 0;
}
.highlight-box .big{color:white}

.ad-slot {
  margin: 20px 0;
  padding: 16px;
  background: #f8fafc;
  border: 1px dashed #cbd5e1;
  border-radius: 14px;
  text-align: center;
  min-height: 100px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.guide-links {
  margin-top: 12px;
  padding: 12px;
  background: #fff;
  border-radius: 10px;
  border: 1px solid var(--line);
}

.guide-links h3 {
  font-size: 14px;
  margin: 0 0 8px 0;
  color: var(--text);
}

.guide-links ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.guide-links li {
  padding: 6px 0;
  font-size: 13px;
  color: var(--muted);
  border-bottom: 1px solid var(--line);
}

.guide-links li:last-child {
  border-bottom: none;
}

.guide-links li::before {
  content: 'â€¢';
  color: var(--accent);
  font-weight: bold;
  margin-right: 8px;
}

/* ê³µìœ  ì„¹ì…˜ */
.share-section{
  margin-top:20px;
  padding:20px 16px;
  text-align:center;
  background:#f8fafc;
  border-radius:14px;
}
.share-section h3{
  margin:0 0 12px;
  font-size:16px;
}
.share-section p{
  margin:0 0 16px;
  font-size:13px;
  color:var(--muted);
}
.share-buttons{
  display:grid;
  gap:10px;
}
.share-btn{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#fff;
  font-size:15px;
  font-weight:900;
  cursor:pointer;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.share-btn:active{
  transform:scale(0.98);
}
.share-btn.save{
  background:#2563eb;
  color:white;
  border-color:#2563eb;
}
.share-btn.share{
  background:#16a34a;
  color:white;
  border-color:#16a34a;
}
.site-footer{
  text-align:center;
  font-size:12px;
  opacity:0.6;
  padding:20px 10px 80px; /* í•˜ë‹¨ ë²„íŠ¼ ê°€ë¦¬ì§€ ì•Šê²Œ */
}
.site-footer a{
  color:inherit;
  text-decoration:none;
  margin:0 6px;
}
</style>
</head>

<body>
<div class="app">

  <div class="app-header">
    <div class="title">ğŸ§  ì¸ìƒê¸ˆìœµì§„ë‹¨</div>
    <div class="header-buttons">
      <button class="header-btn" onclick="saveResult()">ğŸ’¾ ì €ì¥</button>
      <button class="header-btn" onclick="shareResult()">ğŸ“¤ ê³µìœ </button>
    </div>
  </div>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width:0%"></div>
  </div>

  <div id="alkLife">

<!-- ==================== STEP 0: ì§€ì—­ ì„ íƒ ==================== -->
<section class="screen active" id="step0">
  <h1>ğŸ“ 0ë‹¨ê³„: ì§€ì—­ ì„ íƒ</h1>
  <p>ì§€ì—­ì— ë”°ë¼ <b>LTV/DSR</b>ì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</p>

  <div class="card">
    <div class="chipgrid">
      <div class="chip" onclick="selectRegion('seoul', this)">ì„œìš¸
        <small>LTV 40 / DSR 40</small>
      </div>
      <div class="chip" onclick="selectRegion('gg_incheon', this)">ê²½ê¸°Â·ì¸ì²œ
        <small>LTV 50 / DSR 40</small>
      </div>
      <div class="chip" onclick="selectRegion('metro_core', this)">ê´‘ì—­ì‹œ(ê³¼ì—´)
        <small>LTV 60 / DSR 45</small>
      </div>
      <div class="chip" onclick="selectRegion('metro', this)">ê´‘ì—­ì‹œ(ì¼ë°˜)
        <small>LTV 70 / DSR 45</small>
      </div>
      <div class="chip" onclick="selectRegion('local_city', this)">ì§€ë°© ë„ì‹œ
        <small>LTV 75 / DSR 50</small>
      </div>
      <div class="chip" onclick="selectRegion('local', this)">ì§€ë°©(ê¸°íƒ€)
        <small>LTV 80 / DSR 50</small>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="chip" onclick="selectRegion('custom', this)">ê¸°íƒ€ (ì§ì ‘ì…ë ¥)
        <small>ë‚´ ì¡°ê±´ì— ë§ê²Œ LTV/DSR ì„¤ì •</small>
      </div>
    </div>

    <div class="custom-region" id="customRegion">
      <div class="field">
        <label>LTV (%)</label>
        <input type="number" id="customLTV" placeholder="ì˜ˆ: 60" min="0" max="100">
      </div>
      <div class="field">
        <label>DSR (%)</label>
        <input type="number" id="customDSR" placeholder="ì˜ˆ: 45" min="0" max="100">
      </div>
    </div>

    <div class="notice" id="regionBox" style="margin-top:12px;display:none"></div>
  </div>

  <div class="bottom-bar">
    <button class="btn" onclick="showStep(1)">ë‹¤ìŒ â–¶ ë‚´ ì†Œë“/ì§€ì¶œ</button>
  </div>
</section>

<!-- ==================== STEP 1: ì†Œë“/ì§€ì¶œ ==================== -->
<section class="screen" id="step1">
  <h1>ğŸ’° 1ë‹¨ê³„: ë‚´ ì²´ë ¥ ì…ë ¥</h1>
  <p>ì€í–‰ì´ ë³´ëŠ” ê±´ "ê°ì •"ì´ ì•„ë‹ˆë¼ <b>ìˆ«ì</b>ì…ë‹ˆë‹¤.</p>

  <div class="card">
    <div class="field">
      <label>ì—° ì†Œë“ (ì„¸ì „, ë§Œì›)</label>
      <input type="text" id="yearIncome" placeholder="ì˜ˆ: 5,000" data-number>
      <div class="field-hint" id="incomeHint"></div>
    </div>

    <div class="field">
      <label>ì§€ê¸ˆ í†µì¥ì— ìˆëŠ” ëˆ (êµ¬ë§¤ìê¸ˆ ì œì™¸,ë§Œì›)</label>
      <input type="text" id="cash" placeholder="ì˜ˆ: 10,000" data-number>
      <div class="field-hint" id="cashHint"></div>
    </div>

    <div class="field">
      <label>ë§¤ë‹¬ ê³ ì •ì§€ì¶œ (ë§Œì›)</label>
      <input type="text" id="expense" placeholder="ì˜ˆ: 250" data-number>
      <div class="field-hint" id="expenseHint"></div>
    </div>
  </div>

  <div class="bottom-bar">
    <button class="btn" onclick="showStep(2)">ë‹¤ìŒ â–¶ ì§‘ ì¡°ê±´</button>
    <div style="height:8px"></div>
    <button class="btn secondary" onclick="showStep(0)">ì´ì „</button>
  </div>
</section>

<!-- ==================== STEP 2: ì§‘/ëŒ€ì¶œ ì¡°ê±´ ==================== -->
<section class="screen" id="step2">
  <h1>ğŸ  2ë‹¨ê³„: ì§‘ & ê·œì œ ê²€ì‚¬</h1>
  <p>ì—¬ê¸°ì„œ <b>DSR/LTV</b>ë¥¼ í†µê³¼í•´ì•¼ ì‹œë®¬ì´ ëŒì•„ê°‘ë‹ˆë‹¤.</p>

  <div class="card">
    <div class="field">
      <label>ì§‘ ê°€ê²© (ë§Œì›)</label>
      <input type="text" id="housePrice" placeholder="ì˜ˆ: 60,000" data-number>
      <div class="field-hint" id="housePriceHint"></div>
    </div>

    <div class="field">
      <label>ë‚´ê°€ ë„£ì„ ëˆ (ë§Œì›)</label>
      <input type="text" id="myMoney" placeholder="ì˜ˆ: 20,000" data-number>
      <div class="field-hint" id="myMoneyHint"></div>
    </div>

    <div class="row2">
      <div class="field">
        <label>ëŒ€ì¶œ ê¸ˆë¦¬ (ì—° %)</label>
        <input type="text" id="rate" placeholder="ì˜ˆ: 4.2">
      </div>
      <div class="field">
        <label>ëŒ€ì¶œ ê¸°ê°„</label>
        <select id="loanYears">
          <option value="10">10ë…„</option>
          <option value="15">15ë…„</option>
          <option value="20">20ë…„</option>
          <option value="25">25ë…„</option>
          <option value="30" selected>30ë…„</option>
          <option value="35">35ë…„</option>
          <option value="40">40ë…„</option>
          <option value="45">45ë…„</option>
          <option value="50">50ë…„</option>
        </select>
      </div>
    </div>

    <div class="notice" id="ruleInfo">
      ì§€ì—­ì„ ë¨¼ì € ì„ íƒí•˜ë©´, LTV/DSRì´ ìë™ ì ìš©ë©ë‹ˆë‹¤.
    </div>
  </div>

  <div class="bottom-bar">
    <button class="btn" onclick="checkDSRLTV()">ë‹¤ìŒ â–¶ ì§„ë‹¨ ì‹¤í–‰</button>
    <div style="height:8px"></div>
    <button class="btn secondary" onclick="showStep(1)">ì´ì „</button>
  </div>
</section>

<!-- ==================== STEP 3: ê²°ê³¼ ==================== -->
<section class="screen" id="step3">
  <h1>ğŸ“Š 3ë‹¨ê³„: 5ë…„ ì¸ìƒ ì‹œë®¬ ê²°ê³¼</h1>

  <div class="card">
    <div class="big" id="summaryLine">-</div>
    <p id="summarySub">-</p>
  </div>

  <div class="card" id="lifeStructureCard">
    <h2>ğŸ§¾ ë‹¹ì‹ ì˜ ì¸ìƒ êµ¬ì¡° ìš”ì•½</h2>
    <div id="lifeStructureText" class="small">-</div>
  </div>

  <div class="card" id="bottleneckCard">
    <h2>ğŸš¨ ì¸ìƒ ë³‘ëª© ìˆœìœ„</h2>
    <ul class="bottleneck-list" id="bottleneckList">
      <li>-</li>
    </ul>
  </div>

  <div class="guide-links">
    <h3>ğŸ’¡ ê´€ë ¨ ê°€ì´ë“œ</h3>
    <ul>
      <li>ëŒ€ì¶œ ì¡°ê±´ ê°œì„ í•˜ëŠ” ì‹¤ì „ ë°©ë²•</li>
      <li>ì •ë¶€ì§€ì› ëŒ€ì¶œ ìê²© í™•ì¸í•˜ê¸°</li>
      <li>DSR/LTV í†µê³¼ ì „ëµ ì´ì •ë¦¬</li>
    </ul>
  </div>
  
  <div class="ad-slot" id="adSlot1">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3932359368392333"
     crossorigin="anonymous"></script>
<!-- ê¹ƒí—ˆë¸Œ -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3932359368392333"
     data-ad-slot="8728890803"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>

  <div class="card" id="solutionCard">
    <h2>ğŸ’¡ í•´ê²° ë°©ì•ˆ (ìë™ ì œì•ˆ)</h2>
    <div id="solutionText" class="small">-</div>
  </div>

  <div class="card" id="goalCard">
    <h2>ğŸ¯ "ì•ˆì „í•˜ê²Œ" ì‚´ë ¤ë©´ í•„ìš”í•œ ìµœì†Œ ë‚´ ëˆ</h2>
    <div class="small" id="goalText">-</div>
    <div class="small">â€» ì•ˆì „ ê¸°ì¤€: 5ë…„ ë™ì•ˆ <b>í†µì¥ ë§ˆì´ë„ˆìŠ¤ ì—†ìŒ</b> + <b>ìµœì € ì”ê³  â‰¥ 3ê°œì›”ì¹˜ ì§€ì¶œ</b></div>
  </div>

  <div class="card">
    <h2>âš–ï¸ í•œëˆˆì— ë¹„êµí•˜ê¸°</h2>
    <div class="comparison-tabs">
      <div class="tab active" onclick="showComparison('loanYears')">ğŸ“Š ëŒ€ì¶œê¸°ê°„</div>
      <div class="tab" onclick="showComparison('interest')">ğŸ”¥ ì´ì íƒœìš´ ëˆ</div>
      <div class="tab" onclick="showComparison('opportunity')">ğŸ’° ê¸°íšŒë¹„ìš©</div>
      <div class="tab" onclick="showComparison('rateChange')">ğŸ“ˆ ë³€ë™ê¸ˆë¦¬</div>
    </div>
    <div id="comparisonContent">-</div>
    
    <div id="comparisonAdSlot"></div>
  </div>

  <div class="card">
    <h2>ğŸ§ª ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜</h2>
    <p class="small">ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì— ì–¼ë§ˆë‚˜ ë²„í‹¸ ìˆ˜ ìˆì„ê¹Œìš”?</p>
    
    <div class="event-selector">
      <div class="field">
        <label>ì´ë²¤íŠ¸ ì¢…ë¥˜</label>
        <select id="eventType">
          <option value="none">ì—†ìŒ (ê¸°ë³¸)</option>
          <option value="jobLoss3">ì‹¤ì§ 3ê°œì›”</option>
          <option value="jobLoss6">ì‹¤ì§ 6ê°œì›”</option>
          <option value="jobLoss12">ì‹¤ì§ 12ê°œì›”</option>
          <option value="baby">ìœ¡ì•„ (+ì›” 100ë§Œì›, 3ë…„)</option>
          <option value="emergency">ê¸´ê¸‰ ì§€ì¶œ (1,000ë§Œì›)</option>
        </select>
      </div>
      <button class="btn small" onclick="runEventSimulation()">ì‹œë®¬ ì‹¤í–‰</button>
    </div>
    <div id="eventResult" style="margin-top:12px"></div>
  </div>

  <div class="card" id="changeOneNumberCard">
    <h2>ğŸ§ª ìˆ«ì í•˜ë‚˜ë§Œ ë°”ê¿”ì„œ ì¸ìƒ ì‹¤í—˜</h2>
    <p class="small">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ <b>ì¦‰ì‹œ ì¬ê³„ì‚°</b>ë©ë‹ˆë‹¤.</p>
    <div class="row2" style="margin-top:10px">
      <button class="btn secondary" onclick="quickExperiment('priceDown10')">ì§‘ê°’ -10%</button>
      <button class="btn secondary" onclick="quickExperiment('moneyUp3000')">ë‚´ ëˆ +3,000ë§Œ</button>
    </div>
    <div style="height:10px"></div>
    <div class="row2">
      <button class="btn secondary" onclick="quickExperiment('loanYearsUp10')">ëŒ€ì¶œê¸°ê°„ +10ë…„</button>
      <button class="btn" onclick="resetExperiment()">ì‹¤í—˜ ë¦¬ì…‹</button>
    </div>
    <p class="small" id="experimentHint" style="margin-top:10px">-</p>
  </div>

  <div id="warnBox"></div>

  <div class="card">
    <h2>ğŸ“Œ ì„ íƒì§€ ë¹„êµ</h2>
    <div id="resultCards"></div>
  </div>

  <div class="card">
    <h2>ğŸ“ˆ 5ë…„ í†µì¥ íë¦„ (ë§Œì›)</h2>
    <canvas id="cashChart" height="180"></canvas>
    <p class="small">â€» ê·¸ë˜í”„ëŠ” "ì›”ë§ í†µì¥ ì”ê³ "ì˜ ë³€í™”ì…ë‹ˆë‹¤.</p>
  </div>

  <div class="card">
    <h2>ğŸ¤” ì´ ê²°ê³¼ë¥¼ ì‰½ê²Œ ë§í•˜ë©´</h2>
    <p id="explainText">-</p>
  </div>

  <div class="card cta-box">
    <b>ğŸ“ ë” ì•Œì•„ë³´ë©´ ì¢‹ì„ ì£¼ì œ</b>
    <ul style="list-style:none;padding:0;margin:10px 0;text-align:left">
      <li style="padding:6px 0;font-size:13px">â€¢ ì£¼íƒë‹´ë³´ëŒ€ì¶œ ì™„ë²½ ê°€ì´ë“œ</li>
      <li style="padding:6px 0;font-size:13px">â€¢ ìƒì• ìµœì´ˆ íŠ¹ë¡€ëŒ€ì¶œ ì´ì •ë¦¬</li>
      <li style="padding:6px 0;font-size:13px">â€¢ ë¶€ë™ì‚° íˆ¬ì ì‹œë®¬ë ˆì´í„°</li>
    </ul>
  </div>

  <div class="ad-slot" id="adSlot3">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3932359368392333"
     crossorigin="anonymous"></script>
<!-- ê¹ƒí—ˆë¸Œ -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3932359368392333"
     data-ad-slot="8728890803"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </div>

  <!-- ê³µìœ  ì„¹ì…˜ ì¶”ê°€ -->
  <div class="share-section">
    <h3>ğŸ’¬ ì´ ì§„ë‹¨ì´ ë„ì›€ ë˜ì…¨ë‚˜ìš”?</h3>
    <p>ê²°ê³¼ë¥¼ ì €ì¥í•˜ê³  ì¹œêµ¬ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”!</p>
    
    <div class="share-buttons">
      <button class="share-btn save" onclick="saveResult()">
        ğŸ’¾ ê²°ê³¼ ì €ì¥í•˜ê¸°
      </button>
      <button class="share-btn share" onclick="shareResult()">
        ğŸ“¤ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°
      </button>
    </div>
  </div>

  <div class="bottom-bar">
    <button class="btn secondary" onclick="showStep(2)">â¬… ì¡°ê±´ ë°”ê¿”ì„œ ë‹¤ì‹œ</button>
  </div>
</section>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
/* =========================================================
   ì €ì¥/ê³µìœ  ê¸°ëŠ¥ (ë„¤ì´í‹°ë¸Œ ê³µìœ  API)
========================================================= */
function saveResult(){
  const state = _collectStateForShare();
  const enc = _encodeState(state);
  const url = location.origin + location.pathname + "?s=" + encodeURIComponent(enc);

  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(url).then(()=>{
      alert("âœ… ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ ë§í¬ë¡œ ë“¤ì–´ì˜¤ë©´ ì…ë ¥/ê²°ê³¼ê°€ ë³µì›ë©ë‹ˆë‹¤.");
    }).catch(()=>{
      prompt("ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:", url);
    });
  }else{
    prompt("ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:", url);
  }
}

function shareResult(){
  const state = _collectStateForShare();
  const enc = _encodeState(state);
  const url = location.origin + location.pathname + "?s=" + encodeURIComponent(enc);

  // ë„¤ì´í‹°ë¸Œ ê³µìœ  API ì§€ì› í™•ì¸
  if(navigator.share){
    navigator.share({
      title: 'ğŸ§  ì¸ìƒê¸ˆìœµì§„ë‹¨ ê²°ê³¼',
      text: 'ë‚˜ëŠ” ì§‘ì„ ì‚´ ìˆ˜ ìˆì„ê¹Œ? 5ë…„ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!',
      url: url
    }).then(() => {
      console.log('ê³µìœ  ì„±ê³µ!');
    }).catch((error) => {
      console.log('ê³µìœ  ì·¨ì†Œ:', error);
    });
  } else {
    // í´ë°±: ë§í¬ ë³µì‚¬
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(url).then(()=>{
        alert("ğŸ“¤ ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”.");
      }).catch(()=>{
        prompt("ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:", url);
      });
    }else{
      prompt("ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•˜ì„¸ìš”:", url);
    }
  }
}

/* =========================================================
   ì €ì¥/ë³µì›
========================================================= */
function _encodeState(obj){
  try{
    return btoa(unescape(encodeURIComponent(JSON.stringify(obj))));
  }catch(e){
    return btoa(encodeURIComponent(JSON.stringify(obj)));
  }
}
function _decodeState(s){
  try{
    return JSON.parse(decodeURIComponent(escape(atob(s))));
  }catch(e){
    return JSON.parse(decodeURIComponent(atob(s)));
  }
}

function _collectStateForShare(){
  const state = {
    v: 2,
    t: Date.now(),
    regionKey: CURRENT_REGION_KEY,
    customLTV: CURRENT_REGION && CURRENT_REGION.custom ? CURRENT_REGION.ltv : null,
    customDSR: CURRENT_REGION && CURRENT_REGION.custom ? CURRENT_REGION.dsr : null,
    fields: {
      yearIncome: (document.getElementById("yearIncome")||{}).value || "",
      cash: (document.getElementById("cash")||{}).value || "",
      expense: (document.getElementById("expense")||{}).value || "",
      housePrice: (document.getElementById("housePrice")||{}).value || "",
      myMoney: (document.getElementById("myMoney")||{}).value || "",
      rate: (document.getElementById("rate")||{}).value || "",
      loanYears: (document.getElementById("loanYears")||{}).value || "30"
    },
    simInput: window.__SIM_INPUT__ || null,
    baseInput: window.__BASE_INPUT__ || null
  };
  return state;
}

(function restoreFromURL(){
  const params = new URLSearchParams(location.search);
  const s = params.get("s");
  if(!s) return;

  let state = null;
  try{
    state = _decodeState(decodeURIComponent(s));
  }catch(e){
    console.warn("restore failed", e);
    return;
  }

  try{
    const f = (state && state.fields) ? state.fields : {};
    if(document.getElementById("yearIncome")) document.getElementById("yearIncome").value = f.yearIncome || "";
    if(document.getElementById("cash")) document.getElementById("cash").value = f.cash || "";
    if(document.getElementById("expense")) document.getElementById("expense").value = f.expense || "";
    if(document.getElementById("housePrice")) document.getElementById("housePrice").value = f.housePrice || "";
    if(document.getElementById("myMoney")) document.getElementById("myMoney").value = f.myMoney || "";
    if(document.getElementById("rate")) document.getElementById("rate").value = f.rate || "";
    if(document.getElementById("loanYears")) document.getElementById("loanYears").value = f.loanYears || "30";

    if(state.regionKey){
      if(state.regionKey === 'custom' && state.customLTV && state.customDSR){
        document.getElementById("customLTV").value = state.customLTV;
        document.getElementById("customDSR").value = state.customDSR;
      }
      selectRegion(state.regionKey);
    }

    window.__SIM_INPUT__ = state.simInput || null;
    window.__BASE_INPUT__ = state.baseInput || null;

    if(window.__SIM_INPUT__){
      runLifeSimulation();
    }else{
      showStep(state.regionKey ? 1 : 0);
    }
  }catch(e){
    console.warn("restore apply failed", e);
  }
})();

/* =========================================================
   ì§€ì—­ ê·œì¹™
========================================================= */
const REGION_RULES = {
  seoul:       { name:"ì„œìš¸",              ltv:40, dsr:40, note:"ê·œì œ ìµœìƒê¸‰" },
  gg_incheon:  { name:"ê²½ê¸°Â·ì¸ì²œ",   ltv:50, dsr:40, note:"ì„œìš¸ê¸‰ ë‚œì´ë„" },
  metro_core:  { name:"ê´‘ì—­ì‹œ(ê³¼ì—´)", ltv:60, dsr:45, note:"ì§€ì¶œ êµ¬ì¡°ê°€ ì•½í•˜ë©´ ì¦‰ì‚¬" },
  metro:       { name:"ê´‘ì—­ì‹œ(ì¼ë°˜)",       ltv:70, dsr:45, note:"ëŒ€ë¶€ë¶„ ì—¬ê¸°ì„œ ê³„ì‚°ë¨" },
  local_city:  { name:"ì§€ë°© ë„ì‹œ",         ltv:75, dsr:50, note:"ì§‘ë³´ë‹¤ ì¸ìƒ êµ¬ì¡°ê°€ ë¨¼ì €" },
  local:       { name:"ì§€ë°©(ê¸°íƒ€)",        ltv:80, dsr:50, note:"ëŒ€ì¶œì€ ì‰¬ì›Œë„ ë¹ ì ¸ë‚˜ì˜¤ê¸° ì–´ë ¤ì›€" },
};
let CURRENT_REGION = null;
let CURRENT_REGION_KEY = null;

/* =========================================================
   ê³µí†µ ìœ í‹¸
========================================================= */
function showStep(n){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  const target = document.getElementById("step"+n);
  if(target) target.classList.add("active");
  
  const progress = (n / 3) * 100;
  document.getElementById("progressFill").style.width = progress + "%";
  
  window.scrollTo(0,0);
}

function formatNumberInput(el){
  el.addEventListener("input", function(){
    let v = (this.value||"").replace(/,/g,'').replace(/[^\d]/g,'');
    if(!v){ this.value=""; return; }
    this.value = v.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  });
}
document.querySelectorAll("[data-number]").forEach(formatNumberInput);

function parseNum(id){
  const el = document.getElementById(id);
  if(!el) return 0;
  const v = (el.value||"").replace(/,/g,'').trim();
  if(!v) return 0;
  const n = Number(v);
  return Number.isFinite(n) ? n : 0;
}
function won(n){ return `${Math.floor(n).toLocaleString()}ë§Œì›`; }

function annuityPayment(principal, annualRatePct, years){
  if(principal<=0) return 0;
  const r = (annualRatePct/100)/12;
  const n = years*12;
  if(r===0) return principal/n;
  const pow = Math.pow(1+r,n);
  return principal * r * pow / (pow-1);
}
function maxLoanFromMonthlyPay(maxMonthlyPay, annualRatePct, years){
  const r = (annualRatePct/100)/12;
  const n = years*12;
  if(r===0) return maxMonthlyPay*n;
  const pow = Math.pow(1+r,n);
  return maxMonthlyPay * (pow-1) / (r*pow);
}

/* =========================================================
   ì‹¤ì‹œê°„ í”¼ë“œë°±
========================================================= */
function setupRealtimeFeedback(){
  const yearIncomeEl = document.getElementById("yearIncome");
  const cashEl = document.getElementById("cash");
  const expenseEl = document.getElementById("expense");
  const housePriceEl = document.getElementById("housePrice");
  const myMoneyEl = document.getElementById("myMoney");
  
  if(yearIncomeEl){
    yearIncomeEl.addEventListener("input", ()=>{
      const income = parseNum("yearIncome");
      const hint = document.getElementById("incomeHint");
      if(income > 0){
        const monthly = income / 12;
        hint.innerHTML = `ğŸ’¡ ì›” ì†Œë“: ${monthly.toFixed(0)}ë§Œì›`;
        if(CURRENT_REGION){
          const maxMonthPay = (income * (CURRENT_REGION.dsr/100)) / 12;
          hint.innerHTML += ` / DSR ${CURRENT_REGION.dsr}% í•œë„: ì›” ${maxMonthPay.toFixed(0)}ë§Œì›`;
        }
      }else{
        hint.innerHTML = "";
      }
    });
  }
  
  if(cashEl){
    cashEl.addEventListener("input", ()=>{
      const cash = parseNum("cash");
      const expense = parseNum("expense");
      const hint = document.getElementById("cashHint");
      if(cash > 0 && expense > 0){
        const months = cash / expense;
        hint.innerHTML = `ğŸ’¡ í˜„ì¬ í˜„ê¸ˆìœ¼ë¡œ ${months.toFixed(1)}ê°œì›”ì¹˜ ìƒí™œë¹„`;
      }else{
        hint.innerHTML = "";
      }
    });
  }
  
  if(expenseEl){
    expenseEl.addEventListener("input", ()=>{
      const cash = parseNum("cash");
      const expense = parseNum("expense");
      const hint = document.getElementById("expenseHint");
      if(cash > 0 && expense > 0){
        const months = cash / expense;
        hint.innerHTML = `ğŸ’¡ í˜„ì¬ í˜„ê¸ˆìœ¼ë¡œ ${months.toFixed(1)}ê°œì›”ì¹˜`;
      }else{
        hint.innerHTML = "";
      }
    });
  }
  
  if(housePriceEl && myMoneyEl){
    const updateHouseHints = ()=>{
      const housePrice = parseNum("housePrice");
      const myMoney = parseNum("myMoney");
      const cash = parseNum("cash");
      
      const houseHint = document.getElementById("housePriceHint");
      const moneyHint = document.getElementById("myMoneyHint");
      
      if(housePrice > 0 && myMoney > 0){
        const ratio = (myMoney / housePrice) * 100;
        houseHint.innerHTML = `ğŸ’¡ ë‚´ ëˆ ë¹„ìœ¨: ${ratio.toFixed(0)}%`;
        
        const afterCash = cash - myMoney;
        if(afterCash < 0){
          moneyHint.innerHTML = `âš ï¸ í˜„ê¸ˆ ë¶€ì¡± ${Math.abs(afterCash).toLocaleString()}ë§Œì›`;
        }else{
          const expense = parseNum("expense");
          if(expense > 0){
            const months = afterCash / expense;
            moneyHint.innerHTML = `ğŸ’¡ êµ¬ë§¤ í›„ ë‚¨ëŠ” í˜„ê¸ˆ: ${afterCash.toLocaleString()}ë§Œì› (${months.toFixed(1)}ê°œì›”ì¹˜)`;
          }else{
            moneyHint.innerHTML = `ğŸ’¡ êµ¬ë§¤ í›„ ë‚¨ëŠ” í˜„ê¸ˆ: ${afterCash.toLocaleString()}ë§Œì›`;
          }
        }
      }else{
        houseHint.innerHTML = "";
        moneyHint.innerHTML = "";
      }
    };
    
    housePriceEl.addEventListener("input", updateHouseHints);
    myMoneyEl.addEventListener("input", updateHouseHints);
  }
}

function selectRegion(key, el){
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));

  if(el){
    el.classList.add('active');
  }

  if(key === 'custom'){
    const customDiv = document.getElementById("customRegion");
    customDiv.classList.add("active");

    CURRENT_REGION_KEY = 'custom';

    const applyCustom = ()=>{
      const ltv = Number(document.getElementById("customLTV").value || 0);
      const dsr = Number(document.getElementById("customDSR").value || 0);

      if(ltv > 0 && dsr > 0){
        CURRENT_REGION = {
          name: "ê¸°íƒ€(ì§ì ‘ì…ë ¥)",
          ltv: ltv,
          dsr: dsr,
          note: "ì‚¬ìš©ì ì§€ì • ê·œì œ",
          custom: true
        };
        updateRegionDisplay();
      }
    };

    document.getElementById("customLTV").onchange = applyCustom;
    document.getElementById("customDSR").onchange = applyCustom;

    return;
  }

  document.getElementById("customRegion").classList.remove("active");

  CURRENT_REGION = REGION_RULES[key];
  CURRENT_REGION_KEY = key;

  updateRegionDisplay();
}


function updateRegionDisplay(){
  const box = document.getElementById("regionBox");
  box.style.display = "block";
  box.innerHTML = `
    <b>ì„ íƒ ì§€ì—­:</b> ${CURRENT_REGION.name}<br>
    <b>ì ìš© ê·œì œ:</b> LTV ${CURRENT_REGION.ltv}% / DSR ${CURRENT_REGION.dsr}%<br>
    <span class="small">${CURRENT_REGION.note}</span>
  `;

  const ruleInfo = document.getElementById("ruleInfo");
  if(ruleInfo){
    ruleInfo.innerHTML = `
      <b>${CURRENT_REGION.name}</b> ê¸°ì¤€ ì ìš©<br>
      LTV <b>${CURRENT_REGION.ltv}%</b>, DSR <b>${CURRENT_REGION.dsr}%</b><br>
      <span class="small">${CURRENT_REGION.note}</span>
    `;
  }
}

/* =========================================================
   DSR/LTV ê²€ì‚¬
========================================================= */
function checkDSRLTV(){
  if(!CURRENT_REGION){
    alert("ë¨¼ì € 0ë‹¨ê³„ì—ì„œ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
    showStep(0);
    return;
  }

  const yearIncome = parseNum("yearIncome");
  const cash = parseNum("cash");
  const expense = parseNum("expense");

  const housePrice = parseNum("housePrice");
  const myMoney = parseNum("myMoney");
  const rate = Number((document.getElementById("rate").value||"").trim());
  const loanYears = Number(document.getElementById("loanYears").value);

  const ltv = CURRENT_REGION.ltv;
  const dsr = CURRENT_REGION.dsr;

  if(!yearIncome || !cash || !expense){
    alert("1ë‹¨ê³„(ì—°ì†Œë“/í˜„ê¸ˆ/ì›”ì§€ì¶œ)ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
    showStep(1);
    return;
  }
  if(!housePrice || !rate){
    alert("2ë‹¨ê³„(ì§‘ê°€ê²©/ê¸ˆë¦¬)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }
  if(myMoney > housePrice){
    alert("ë‚´ê°€ ë„£ì„ ëˆì´ ì§‘ ê°€ê²©ë³´ë‹¤ í½ë‹ˆë‹¤.");
    return;
  }

  const needLoan = Math.max(0, housePrice - myMoney);

  const maxLoanByLTV = housePrice * (ltv/100);

  const maxYearPay = yearIncome * (dsr/100);
  const maxMonthPay = maxYearPay / 12;

  const maxLoanByDSR = maxLoanFromMonthlyPay(maxMonthPay, rate, loanYears);

  const realMaxLoan = Math.min(maxLoanByLTV, maxLoanByDSR);

  const reasons = [];
  if(needLoan > maxLoanByLTV){
    reasons.push(`LTV ${ltv}%: ì´ ì§‘ì€ ìµœëŒ€ ${won(maxLoanByLTV)}ê¹Œì§€ë§Œ ëŒ€ì¶œ ê°€ëŠ¥`);
  }
  if(needLoan > maxLoanByDSR){
    reasons.push(`DSR ${dsr}%: ì›” ìƒí™˜ í•œë„(${won(maxMonthPay)}) ë•Œë¬¸ì— ì•½ ${won(maxLoanByDSR)}ê¹Œì§€ë§Œ ê°€ëŠ¥`);
  }

  if(reasons.length){
    let msg = "âŒ ëƒ‰ì •í•˜ê²Œ ë§í•˜ë©´, ì§€ê¸ˆ ì¡°ê±´ìœ¼ë¡œëŠ” ë§‰í™ë‹ˆë‹¤.\n\n";
    reasons.forEach(r=> msg += "â€¢ " + r + "\n");
    msg += `\nğŸ‘‰ ê°€ëŠ¥í•œ ìµœëŒ€ ëŒ€ì¶œ: ${won(realMaxLoan)}`;
    msg += `\nğŸ‘‰ ì´ ì¡°ê±´ì—ì„œ ê°€ëŠ¥í•œ ìµœëŒ€ ì§‘ê°’: ${won(realMaxLoan + myMoney)}`;
    alert(msg);
    return;
  }

  const monthlyPay = annuityPayment(needLoan, rate, loanYears);

  window.__SIM_INPUT__ = {
    region: CURRENT_REGION.name,
    ltv, dsr,
    yearIncome, cash, expense,
    housePrice, myMoney,
    rate, loanYears,
    needLoan, monthlyPay,
    maxLoanByLTV, maxLoanByDSR, realMaxLoan,
    maxMonthPay
  };

  window.__BASE_INPUT__ = null;

  runLifeSimulation();
}

/* =========================================================
   ì§„ë‹¨ (ë³‘ëª© ìš°ì„ ìˆœìœ„)
========================================================= */
function diagnose(inp){
  const {
    region, ltv, dsr,
    yearIncome, cash, expense,
    housePrice, myMoney,
    rate, loanYears,
    needLoan, monthlyPay,
    maxLoanByLTV, maxLoanByDSR, realMaxLoan, maxMonthPay
  } = inp;

  const structureLines = [];
  structureLines.push(`â€¢ ì§€ì—­: <b>${region}</b> (LTV ${ltv}% / DSR ${dsr}%)`);
  structureLines.push(`â€¢ ì—°ì†Œë“(ì„¸ì „): <b>${won(yearIncome)}</b>`);
  structureLines.push(`â€¢ DSR ${dsr}% â†’ ì›” ìƒí™˜ í•œë„: <b>${won(maxMonthPay)}</b>`);
  structureLines.push(`â€¢ (DSR ê¸°ì¤€) ê°€ëŠ¥í•œ ìµœëŒ€ ëŒ€ì¶œ: <b>${won(maxLoanByDSR)}</b>`);
  structureLines.push(`â€¢ (LTV ê¸°ì¤€) ì´ ì§‘ ìµœëŒ€ ëŒ€ì¶œ: <b>${won(maxLoanByLTV)}</b>`);
  structureLines.push(`â€¢ ì‹¤ì œ ê°€ëŠ¥í•œ ìµœëŒ€ ëŒ€ì¶œ: <b>${won(realMaxLoan)}</b>`);
  structureLines.push(`â€¢ ì§‘ ê°€ê²©: <b>${won(housePrice)}</b> / ë‚´ ëˆ: <b>${won(myMoney)}</b>`);
  structureLines.push(`â€¢ í•„ìš” ëŒ€ì¶œ: <b>${won(needLoan)}</b> / ì›” ìƒí™˜ì•¡: <b>${won(monthlyPay)}</b>`);

  const dsrUsage = maxLoanByDSR > 0 ? (needLoan / maxLoanByDSR) : 0;
  const ltvUsage = maxLoanByLTV > 0 ? (needLoan / maxLoanByLTV) : 0;

  const cashAfterDown = Math.max(0, cash - myMoney);
  const runwayMonths = expense > 0 ? (cashAfterDown / expense) : 999;
  const downRatio = housePrice > 0 ? (myMoney / housePrice) : 0;

  const bottlenecks = [];

  if(dsrUsage >= 0.9){
    bottlenecks.push({
      level: "high",
      title: "DSR(ìƒí™˜ëŠ¥ë ¥) ë³‘ëª©",
      desc: `ì—°ì†Œë“ ëŒ€ë¹„ ì›” ìƒí™˜ í•œë„ì— ${(dsrUsage*100).toFixed(0)}% ë„ë‹¬. ê¸ˆë¦¬/ê¸°ê°„ ì¡°ì • í•„ìš”.`,
      score: dsrUsage * 100
    });
  }else if(dsrUsage >= 0.7){
    bottlenecks.push({
      level: "med",
      title: "DSR ì£¼ì˜",
      desc: `ì›” ìƒí™˜ í•œë„ ${(dsrUsage*100).toFixed(0)}% ì‚¬ìš© ì¤‘. ì—¬ìœ  ìˆìŒ.`,
      score: dsrUsage * 80
    });
  }

  if(ltvUsage >= 0.9){
    bottlenecks.push({
      level: "high",
      title: "LTV(ë‹´ë³´í•œë„) ë³‘ëª©",
      desc: `ë‹´ë³´ í•œë„ì— ${(ltvUsage*100).toFixed(0)}% ë„ë‹¬. ì§‘ê°’ ì¡°ì • ë˜ëŠ” ë‚´ ëˆ ì¶”ê°€ í•„ìš”.`,
      score: ltvUsage * 100
    });
  }

  if(runwayMonths < 3){
    bottlenecks.push({
      level: "high",
      title: "í˜„ê¸ˆ ë°©ì–´ë ¥ ìœ„í—˜",
      desc: `êµ¬ë§¤ í›„ ë‚¨ëŠ” í˜„ê¸ˆì´ ${runwayMonths.toFixed(1)}ê°œì›”ì¹˜ ì§€ì¶œ. ë³€ìˆ˜ í•˜ë‚˜ë©´ í”ë“¤ë¦¼.`,
      score: (6 - runwayMonths) * 20
    });
  }else if(runwayMonths < 6){
    bottlenecks.push({
      level: "med",
      title: "í˜„ê¸ˆ ë°©ì–´ë ¥ ë¶€ì¡±",
      desc: `êµ¬ë§¤ í›„ ${runwayMonths.toFixed(1)}ê°œì›”ì¹˜ í˜„ê¸ˆ. ìµœì†Œ 6ê°œì›”ì¹˜ í™•ë³´ ê¶Œì¥.`,
      score: (6 - runwayMonths) * 15
    });
  }

  if(downRatio < 0.2){
    bottlenecks.push({
      level: "high",
      title: "ë‚´ ëˆ ë¹„ì¤‘ ë‚®ìŒ",
      desc: `ë‚´ ëˆ ${(downRatio*100).toFixed(0)}%. ëŒ€ì¶œ ì˜ì¡´ë„ ë†’ì•„ ê¸ˆë¦¬ ë³€ë™ì— ì·¨ì•½.`,
      score: (0.3 - downRatio) * 100
    });
  }else if(downRatio < 0.3){
    bottlenecks.push({
      level: "med",
      title: "ë‚´ ëˆ ë¹„ì¤‘ ì£¼ì˜",
      desc: `ë‚´ ëˆ ${(downRatio*100).toFixed(0)}%. ì—¬ìœ  ìˆì§€ë§Œ ë” ë†’ì´ë©´ ì•ˆì •ì .`,
      score: (0.3 - downRatio) * 50
    });
  }

  bottlenecks.sort((a,b) => b.score - a.score);

  if(bottlenecks.length === 0){
    bottlenecks.push({
      level: "low",
      title: "ì„ íƒì˜ ë¬¸ì œ",
      desc: "ê·œì œëŠ” í†µê³¼. ì§€ê¸ˆ ì‚¬ëŠëƒ / 2ë…„ ë’¤ ì‚¬ëŠëƒê°€ ë¯¸ë˜ë¥¼ ê°€ë¦…ë‹ˆë‹¤."
    });
  }

  return { structureLines, bottlenecks, dsrUsage, ltvUsage, runwayMonths, downRatio };
}

/* =========================================================
   ëŒ€ì•ˆ ì œì‹œ
========================================================= */
function suggestSolutions(inp, diagnosis){
  const solutions = [];
  
  const { dsrUsage, ltvUsage, runwayMonths, downRatio } = diagnosis;
  const { loanYears, needLoan, rate, monthlyPay, expense, cash, myMoney } = inp;
  
  if(dsrUsage >= 0.85){
    const newYears = Math.min(50, loanYears + 10);
    const newPayment = annuityPayment(needLoan, rate, newYears);
    solutions.push({
      icon: "âœ…",
      title: "ëŒ€ì¶œê¸°ê°„ ì—°ì¥",
      desc: `${loanYears}ë…„ â†’ ${newYears}ë…„ìœ¼ë¡œ ëŠ˜ë¦¬ë©´ ì›” ìƒí™˜ì•¡ ${won(monthlyPay)} â†’ ${won(newPayment)} (${won(monthlyPay - newPayment)} ì ˆê°)`
    });
  }
  
  if(runwayMonths < 6){
    const needCash = expense * 6;
    const reduceMoney = Math.max(0, needCash - (cash - myMoney));
    if(reduceMoney > 0 && reduceMoney < myMoney){
      solutions.push({
        icon: "âœ…",
        title: "ì´ˆê¸°ìê¸ˆ ì¡°ì •",
        desc: `ë‚´ ëˆì„ ${won(reduceMoney)} ì¤„ì—¬ì„œ ì•ˆì „ í˜„ê¸ˆ(6ê°œì›”ì¹˜) í™•ë³´`
      });
    }
  }
  
  const reduceExpense = expense * 0.2;
  solutions.push({
    icon: "ğŸ’¡",
    title: "ì§€ì¶œ ìµœì í™”",
    desc: `ì›” ì§€ì¶œ ${won(reduceExpense)} ì¤„ì´ë©´ 5ë…„ í›„ ì”ê³  ì•½ ${won(reduceExpense * 60)} ê°œì„ `
  });
  
  return solutions;
}

/* =========================================================
   ì‹¤í—˜ ê¸°ëŠ¥
========================================================= */
window.__BASE_INPUT__ = null;

function quickExperiment(type){
  if(!window.__SIM_INPUT__) return;

  if(!window.__BASE_INPUT__){
    window.__BASE_INPUT__ = JSON.parse(JSON.stringify(window.__SIM_INPUT__));
  }
  const base = JSON.parse(JSON.stringify(window.__BASE_INPUT__));

  if(type === "priceDown10"){
    base.housePrice = Math.max(0, Math.round(base.housePrice * 0.9));
  }
  if(type === "moneyUp3000"){
    base.myMoney = base.myMoney + 3000;
    if(base.myMoney > base.housePrice) base.myMoney = base.housePrice;
  }
  if(type === "loanYearsUp10"){
    base.loanYears = Math.min(50, base.loanYears + 10);
  }

  const needLoan = Math.max(0, base.housePrice - base.myMoney);
  const maxLoanByLTV = base.housePrice * (base.ltv/100);
  const maxYearPay = base.yearIncome * (base.dsr/100);
  const maxMonthPay = maxYearPay / 12;
  const monthlyPay = annuityPayment(needLoan, base.rate, base.loanYears);
  const maxLoanByDSR = maxLoanFromMonthlyPay(maxMonthPay, base.rate, base.loanYears);
  const realMaxLoan = Math.min(maxLoanByLTV, maxLoanByDSR);

  base.needLoan = needLoan;
  base.monthlyPay = monthlyPay;
  base.maxLoanByLTV = maxLoanByLTV;
  base.maxLoanByDSR = maxLoanByDSR;
  base.realMaxLoan = realMaxLoan;
  base.maxMonthPay = maxMonthPay;

  window.__SIM_INPUT__ = base;

  const hint = document.getElementById("experimentHint");
  if(hint){
    if(type==="priceDown10") hint.innerHTML = `âœ… ì‹¤í—˜: <b>ì§‘ê°’ -10%</b>`;
    if(type==="moneyUp3000") hint.innerHTML = `âœ… ì‹¤í—˜: <b>ë‚´ ëˆ +3,000ë§Œ</b>`;
    if(type==="loanYearsUp10") hint.innerHTML = `âœ… ì‹¤í—˜: <b>ëŒ€ì¶œê¸°ê°„ +10ë…„</b>`;
  }

  runLifeSimulation();
}
function resetExperiment(){
  if(window.__BASE_INPUT__){
    window.__SIM_INPUT__ = JSON.parse(JSON.stringify(window.__BASE_INPUT__));
    window.__BASE_INPUT__ = null;
  }
  const hint = document.getElementById("experimentHint");
  if(hint) hint.innerHTML = `ğŸ” ì›ë˜ ì…ë ¥ê°’ìœ¼ë¡œ ë³µì›`;
  runLifeSimulation();
}

/* =========================================================
   ì•ˆì „ ìµœì†Œ ë‚´ëˆ ì°¾ê¸°
========================================================= */
function simulateWithInput(inp, mode, eventType){
  const { yearIncome, cash, expense, rate, loanYears, needLoan, monthlyPay } = inp;

  let eventIncomeMultiplier = 1;
  let eventExpenseAdd = 0;
  let eventCashDeduct = 0;
  let eventStartMonth = 0;
  let eventEndMonth = 60;

  if(eventType === "jobLoss3"){ eventIncomeMultiplier = 0; eventStartMonth = 12; eventEndMonth = 15; }
  if(eventType === "jobLoss6"){ eventIncomeMultiplier = 0; eventStartMonth = 12; eventEndMonth = 18; }
  if(eventType === "jobLoss12"){ eventIncomeMultiplier = 0; eventStartMonth = 12; eventEndMonth = 24; }
  if(eventType === "baby"){ eventExpenseAdd = 100; eventStartMonth = 1; eventEndMonth = 36; }
  if(eventType === "emergency"){ eventCashDeduct = 1000; eventStartMonth = 12; eventEndMonth = 12; }

  const monthlyIncome = yearIncome / 12;
  let curCash = cash;
  let debt = needLoan;
  let minCash = Infinity, minMonth = 1;
  let totalInterest = 0;
  const series = [];

  for(let m=1; m<=60; m++){
    let income = monthlyIncome;
    let out = expense;

    if(m >= eventStartMonth && m <= eventEndMonth){
      income *= eventIncomeMultiplier;
      out += eventExpenseAdd;
    }
    if(m === eventStartMonth && eventType === "emergency"){
      curCash -= eventCashDeduct;
    }

    const inLoanPhase = (mode==="buy");
    if(inLoanPhase && debt>0){
      const r = (rate/100)/12;
      const interest = debt*r;
      const principal = Math.max(0, monthlyPay - interest);
      totalInterest += interest;
      debt = Math.max(0, debt - principal);
      out += (interest + principal);
    }

    curCash += (income - out);
    series.push(curCash);

    if(curCash < minCash){ minCash = curCash; minMonth = m; }
  }

  return { series, endCash: curCash, minCash, minMonth, totalInterest };
}

function isSafeScenario(sim, expense){
  if(sim.minCash < 0) return false;
  if(sim.minCash < expense * 3) return false;
  return true;
}

function findMinMyMoneyForSafety(baseInput){
  let low = 0;
  let high = baseInput.housePrice;
  let answer = null;

  for(let i=0;i<30;i++){
    let mid = Math.floor((low + high) / 2);

    let test = JSON.parse(JSON.stringify(baseInput));
    test.myMoney = mid;

    test.needLoan = Math.max(0, test.housePrice - test.myMoney);
    test.monthlyPay = annuityPayment(test.needLoan, test.rate, test.loanYears);

    const sim = simulateWithInput(test, "buy", "none");

    if(isSafeScenario(sim, test.expense)){
      answer = mid;
      high = mid;
    } else {
      low = mid + 1;
    }
  }

  return answer;
}

/* =========================================================
   ë¹„êµ íƒ­
========================================================= */
let CURRENT_COMPARISON = null;

function showComparison(type){
  CURRENT_COMPARISON = type;
  
  document.querySelectorAll('.comparison-tabs .tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  
  const content = document.getElementById("comparisonContent");
  const inp = window.__SIM_INPUT__;
  if(!inp){ content.innerHTML = "ë¨¼ì € ì§„ë‹¨ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”."; return; }
  
  const adSlot = document.getElementById("comparisonAdSlot");
  adSlot.innerHTML = "";
  
  if(type === "loanYears"){
    showLoanYearsComparison(inp, content);
  }
  if(type === "interest"){
    showInterestComparison(inp, content);
    adSlot.innerHTML = `
      <div class="guide-links" style="margin-top:16px">
        <h3>ğŸ’¡ ì´ì ì ˆì•½ ê°€ì´ë“œ</h3>
        <ul>
          <li>ëŒ€í™˜ëŒ€ì¶œ ì™„ë²½ ì²´í¬ë¦¬ìŠ¤íŠ¸</li>
          <li>ê¸ˆë¦¬ í˜‘ìƒ ì‹¤ì „ ë…¸í•˜ìš°</li>
          <li>ê³ ì • vs ë³€ë™ê¸ˆë¦¬ ì„ íƒ ê°€ì´ë“œ</li>
        </ul>
      </div>
    `;
  }
  if(type === "opportunity"){
    showOpportunityComparison(inp, content);
  }
  if(type === "rateChange"){
    showRateChangeComparison(inp, content);
  }
}

function showLoanYearsComparison(inp, content){
  const years = [25, 30, 45];
  const results = [];
  
  years.forEach(y => {
    const test = JSON.parse(JSON.stringify(inp));
    test.loanYears = y;
    test.monthlyPay = annuityPayment(test.needLoan, test.rate, y);
    const sim = simulateWithInput(test, "buy", "none");
    results.push({ years: y, monthlyPay: test.monthlyPay, sim });
  });
  
  let html = `<div style="margin-top:12px">`;
  html += `<h3 style="margin:0 0 10px">ğŸ“Š ëŒ€ì¶œ ê¸°ê°„ë³„ ì™„ì „ ë¹„êµ</h3>`;
  
  results.forEach((r, idx) => {
    const isCurrent = r.years === inp.loanYears;
    html += `<div class="result-card ${isCurrent ? 'best' : ''}" style="margin-bottom:10px">`;
    html += `<b>ğŸ“Œ ${r.years}ë…„ ${isCurrent ? '(í˜„ì¬ ì„ íƒ) âœ…' : ''}</b><br>`;
    html += `ì›” ìƒí™˜ì•¡: <b>${won(r.monthlyPay)}</b>`;
    if(idx > 0){
      const diff = r.monthlyPay - results[0].monthlyPay;
      html += ` (${diff > 0 ? '+' : ''}${won(diff)})`;
    }
    html += `<br>`;
    html += `5ë…„ ì´ì: <b>${won(r.sim.totalInterest)}</b><br>`;
    html += `5ë…„ í›„ ì”ê³ : <b>${won(r.sim.endCash)}</b><br>`;
    html += `</div>`;
  });
  
  html += `<div class="info" style="margin-top:10px">`;
  html += `ğŸ§  <b>ì§„ë‹¨:</b><br>`;
  html += `â€¢ 45ë…„ì€ ë‹¹ì¥ ìƒì¡´ì— ìœ ë¦¬ (ì›” ìƒí™˜ ë¶€ë‹´ ë‚®ìŒ)<br>`;
  html += `â€¢ 25ë…„ì€ ì´ ì´ì ì ˆì•½ (ë¹¨ë¦¬ ë¹š íƒˆì¶œ)<br>`;
  html += `â€¢ ì„ íƒì€ ë‹¹ì‹ ì˜ "ì§€ê¸ˆ ì—¬ìœ " vs "ì´ ë¹„ìš©"`;
  html += `</div>`;
  html += `</div>`;
  
  content.innerHTML = html;
}

function showInterestComparison(inp, content){
  const sim = simulateWithInput(inp, "buy", "none");
  const totalInterest = sim.totalInterest;
  
  let html = `<div style="margin-top:12px">`;
  html += `<div class="highlight-box">`;
  html += `<h3 style="margin:0 0 10px;color:white">ğŸ”¥ 5ë…„ê°„ ì´ìë¡œ íƒœìš´ ëˆ</h3>`;
  html += `<div class="big">${won(totalInterest)}</div>`;
  html += `</div>`;
  
  html += `<div class="info" style="margin-top:12px">`;
  html += `<b>ğŸ’€ ì´ ëˆì´ë©´...</b><br>`;
  html += `âœ“ ì•„ë°˜ë–¼ ì‹ ì°¨ ${(totalInterest / 1300).toFixed(1)}ëŒ€<br>`;
  html += `âœ“ ì „ì„¸ ë³´ì¦ê¸ˆ ${won(totalInterest)} ì¶”ê°€<br>`;
  html += `âœ“ ì›”ì„¸ 25ë§Œì› Ã— ${Math.floor(totalInterest / 25)}ê°œì›”<br>`;
  html += `âœ“ í•´ì™¸ì—¬í–‰ ${Math.floor(totalInterest / 145)}ë²ˆ (1ì¸ 145ë§Œì›)`;
  html += `</div>`;
  
  const rates = [inp.rate - 0.5, inp.rate, inp.rate + 1];
  html += `<h3 style="margin:20px 0 10px">ğŸ§® ê¸ˆë¦¬ë³„ 5ë…„ ì´ì ë¹„êµ</h3>`;
  rates.forEach(r => {
    const test = JSON.parse(JSON.stringify(inp));
    test.rate = r;
    test.monthlyPay = annuityPayment(test.needLoan, r, test.loanYears);
    const s = simulateWithInput(test, "buy", "none");
    const isCurrent = r === inp.rate;
    html += `<div class="result-card ${isCurrent ? 'best' : ''}">`;
    html += `ê¸ˆë¦¬ ${r.toFixed(1)}% ${isCurrent ? '(í˜„ì¬)' : ''}: <b>${won(s.totalInterest)}</b>`;
    if(!isCurrent){
      const diff = s.totalInterest - totalInterest;
      html += ` (${diff > 0 ? '+' : ''}${won(diff)})`;
    }
    html += `</div>`;
  });
  
  html += `<div class="notice" style="margin-top:10px">`;
  html += `ğŸ’¡ ê¸ˆë¦¬ 0.5%ë§Œ ë‚®ì¶°ë„ 5ë…„ê°„ ì•½ ${won(totalInterest * 0.1)} ì ˆì•½!`;
  html += `</div>`;
  html += `</div>`;
  
  content.innerHTML = html;
}

function showOpportunityComparison(inp, content){
  const monthlyIncome = inp.yearIncome / 12;
  const monthlySavings = monthlyIncome - inp.expense;
  const savings5y = monthlySavings * 60;
  const finalCash = inp.cash + savings5y;
  
  const simBuy = simulateWithInput(inp, "buy", "none");
  const cashDiff = finalCash - simBuy.endCash;
  
  let html = `<div style="margin-top:12px">`;
  html += `<h3 style="margin:0 0 10px">ğŸ¤” ë§Œì•½ ì§‘ ì•ˆ ì‚¬ê³  5ë…„ ë” ëª¨ì•˜ë‹¤ë©´?</h3>`;
  
  html += `<div class="info">`;
  html += `<b>ğŸ“Œ ì‹œë‚˜ë¦¬ì˜¤: êµ¬ë§¤ í¬ê¸° + ì €ì¶•</b><br><br>`;
  html += `â€¢ ì´ˆê¸° í˜„ê¸ˆ: ${won(inp.cash)}<br>`;
  html += `â€¢ ì›” ì†Œë“: ${won(monthlyIncome)}<br>`;
  html += `â€¢ ì›” ì§€ì¶œ: ${won(inp.expense)}<br>`;
  html += `â€¢ ë§¤ë‹¬ ì €ì¶• ê°€ëŠ¥: <b>${won(monthlySavings)}</b>`;
  html += `</div>`;
  
  html += `<div class="highlight-box" style="margin-top:12px">`;
  html += `<h3 style="margin:0 0 10px;color:white">ğŸ’° 5ë…„ í›„ ëª¨ì´ëŠ” ëˆ</h3>`;
  html += `<div class="big">${won(finalCash)}</div>`;
  html += `<div style="margin-top:8px;font-size:14px">`;
  html += `(ì´ˆê¸° ${won(inp.cash)} + ì €ì¶• ${won(savings5y)})`;
  html += `</div>`;
  html += `</div>`;
  
  html += `<div class="result-card best" style="margin-top:12px">`;
  html += `<b>ğŸ¡ ì´ ëˆì´ë©´ ì‚´ ìˆ˜ ìˆëŠ” ì§‘</b><br><br>`;
  const possibleHouse = finalCash / 0.2;
  html += `ë‚´ ëˆ ${won(finalCash)} = ì§‘ê°’ ì•½ <b>${won(possibleHouse)}</b> ê°€ëŠ¥<br>`;
  html += `(LTV 80% ê°€ì •)`;
  html += `</div>`;
  
  html += `<div class="info" style="margin-top:12px">`;
  html += `<b>ğŸ’¡ ê²°ë¡ </b><br><br>`;
  html += `[ì§€ê¸ˆ ì‚°ë‹¤]<br>`;
  html += `â€¢ 5ë…„ í›„ ì”ê³ : ${won(simBuy.endCash)}<br>`;
  html += `â€¢ 5ë…„ ì´ì: ${won(simBuy.totalInterest)}<br><br>`;
  html += `[5ë…„ ë” ëª¨ì€ë‹¤]<br>`;
  html += `â€¢ 5ë…„ í›„ ì”ê³ : ${won(finalCash)}<br>`;
  html += `â€¢ ì°¨ì´: <b>${won(cashDiff)}</b> ë” ì—¬ìœ ë¡œì›€!<br><br>`;
  html += `âš ï¸ ë‹¨, ì§‘ê°’ì´ ${((cashDiff/inp.housePrice)*100).toFixed(0)}% ì´ìƒ ì˜¤ë¥´ë©´ ì—­ì „`;
  html += `</div>`;
  html += `</div>`;
  
  content.innerHTML = html;
}

function showRateChangeComparison(inp, content){
  const rateChanges = [0, 1, 2];
  const results = [];
  
  rateChanges.forEach(change => {
    const test = JSON.parse(JSON.stringify(inp));
    test.rate = inp.rate + change;
    test.monthlyPay = annuityPayment(test.needLoan, test.rate, test.loanYears);
    const sim = simulateWithInput(test, "buy", "none");
    results.push({ change, rate: test.rate, monthlyPay: test.monthlyPay, sim });
  });
  
  let html = `<div style="margin-top:12px">`;
  html += `<h3 style="margin:0 0 10px">ğŸ“ˆ ê¸ˆë¦¬ ë³€ë™ ì‹œë®¬ë ˆì´ì…˜</h3>`;
  
  results.forEach((r, idx) => {
    const isCurrent = r.change === 0;
    const severity = r.change === 0 ? '' : (r.change === 1 ? 'notice' : 'danger');
    html += `<div class="${severity ? severity : 'result-card'}" style="margin-bottom:10px;${!severity ? 'border:1px solid var(--line);padding:14px;border-radius:14px' : ''}">`;
    html += `<b>${isCurrent ? 'í˜„ì¬ ê¸ˆë¦¬' : `ê¸ˆë¦¬ +${r.change}%p`} (${r.rate.toFixed(1)}%) ${isCurrent ? 'âœ…' : ''}</b><br>`;
    html += `â†’ ì›” ìƒí™˜ì•¡: <b>${won(r.monthlyPay)}</b>`;
    if(idx > 0){
      const diff = r.monthlyPay - results[0].monthlyPay;
      html += ` (+${won(diff)} ${r.change === 2 ? 'ğŸš¨' : 'âš ï¸'})`;
    }
    html += `<br>`;
    html += `â†’ 5ë…„ í›„ ì”ê³ : <b>${won(r.sim.endCash)}</b>`;
    if(idx > 0){
      const diff = r.sim.endCash - results[0].sim.endCash;
      html += ` (${won(diff)})`;
    }
    html += `</div>`;
  });
  
  html += `<div class="info" style="margin-top:10px">`;
  html += `ğŸ§  <b>ì§„ë‹¨:</b><br>`;
  html += `ê¸ˆë¦¬ê°€ 2%p ì˜¤ë¥´ë©´ ì›” ${won(results[2].monthlyPay - results[0].monthlyPay)} ë” ëƒ…ë‹ˆë‹¤.<br>`;
  html += `ë³€ë™ê¸ˆë¦¬ë¼ë©´ ê³ ì •ê¸ˆë¦¬ ì „í™˜ì„ ê³ ë ¤í•˜ì„¸ìš”.`;
  html += `</div>`;
  html += `</div>`;
  
  content.innerHTML = html;
}

/* =========================================================
   ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
========================================================= */
function runEventSimulation(){
  const inp = window.__SIM_INPUT__;
  if(!inp){ alert("ë¨¼ì € ì§„ë‹¨ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”."); return; }
  
  const eventType = document.getElementById("eventType").value;
  const resultDiv = document.getElementById("eventResult");
  
  if(eventType === "none"){
    resultDiv.innerHTML = "";
    return;
  }
  
  const sim = simulateWithInput(inp, "buy", eventType);
  
  let html = `<div class="info">`;
  html += `<b>ğŸ§ª ì´ë²¤íŠ¸ ì‹œë®¬ ê²°ê³¼</b><br><br>`;
  
  let eventName = "";
  if(eventType.startsWith("jobLoss")) eventName = `ì‹¤ì§ ${eventType.slice(-1) === '3' ? '3ê°œì›”' : eventType.slice(-1) === '6' ? '6ê°œì›”' : '12ê°œì›”'}`;
  if(eventType === "baby") eventName = "ìœ¡ì•„ (ì›” +100ë§Œì›, 3ë…„)";
  if(eventType === "emergency") eventName = "ê¸´ê¸‰ ì§€ì¶œ 1,000ë§Œì›";
  
  html += `ì´ë²¤íŠ¸: <b>${eventName}</b><br>`;
  html += `í†µì¥ ìµœì €ì : <b>${won(sim.minCash)}</b> (${sim.minMonth}ê°œì›”ì°¨)<br>`;
  html += `5ë…„ í›„ ì”ê³ : <b>${won(sim.endCash)}</b><br><br>`;
  
  if(sim.minCash < 0){
    html += `ğŸš¨ <b>ìœ„í—˜:</b> í†µì¥ì´ ë§ˆì´ë„ˆìŠ¤ê°€ ë©ë‹ˆë‹¤!<br>`;
    html += `ë¹„ìƒ ìê¸ˆ <b>${won(Math.abs(sim.minCash))}</b> ì¶”ê°€ í•„ìš”`;
  }else if(sim.minCash < inp.expense * 3){
    html += `âš ï¸ <b>ì£¼ì˜:</b> ìµœì € ì”ê³ ê°€ ${(sim.minCash / inp.expense).toFixed(1)}ê°œì›”ì¹˜ë¡œ ë¹ ë“¯í•©ë‹ˆë‹¤.`;
  }else{
    html += `âœ… <b>ì•ˆì „:</b> ì´ë²¤íŠ¸ ë°œìƒí•´ë„ ë²„í‹¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
  }
  
  html += `</div>`;
  resultDiv.innerHTML = html;
}

/* =========================================================
   ë©”ì¸ ì‹œë®¬ë ˆì´ì…˜
========================================================= */
function runLifeSimulation(){
  const inp = window.__SIM_INPUT__;
  if(!inp){ alert("ë¨¼ì € DSR/LTV ê²€ì‚¬ë¥¼ í†µê³¼í•´ì•¼ í•©ë‹ˆë‹¤."); return; }

  const {
    yearIncome, cash, expense,
    housePrice, myMoney,
    rate, loanYears, needLoan, monthlyPay, maxMonthPay
  } = inp;

  const base = JSON.parse(JSON.stringify(inp));
  const minMoney = findMinMyMoneyForSafety(base);

  let goalMsg = "";
  if(minMoney === null){
    goalMsg = "âŒ ì´ ì§‘ì€ ë‚´ ëˆì„ ì•„ë¬´ë¦¬ ë„£ì–´ë„ í˜„ì¬ ì†Œë“/ì§€ì¶œë¡œëŠ” 5ë…„ ì•ˆì „ ê¸°ì¤€ ë¯¸ë‹¬.";
  } else {
    goalMsg += `â€¢ ì´ ì§‘ì„ <b>ì•ˆì „í•˜ê²Œ</b> ì‚¬ë ¤ë©´: ë‚´ ëˆ ìµœì†Œ <b>${minMoney.toLocaleString()}ë§Œì›</b><br>`;
    if(minMoney > base.myMoney){
      goalMsg += `â†’ ì§€ê¸ˆë³´ë‹¤ <b>${(minMoney - base.myMoney).toLocaleString()}ë§Œì›</b> ë” í•„ìš”`;
    } else {
      goalMsg += `â†’ í˜„ì¬ ë‚´ ëˆìœ¼ë¡œë„ "ì•ˆì „ ê¸°ì¤€" í†µê³¼ âœ…`;
    }
  }
  const goalBox = document.getElementById("goalText");
  if(goalBox) goalBox.innerHTML = goalMsg;

  const A = simulateWithInput(inp, "buy", "none");
  const B = simulateWithInput(inp, "save", "none");

  const results = [
    { key:"A", name:"ğŸ  ì§€ê¸ˆ ì‚°ë‹¤", data:A },
    { key:"B", name:"ğŸ’° ëˆ ë” ëª¨ì•„ì„œ ì‚°ë‹¤", data:B }
  ];

  function score(r){
    let s = r.data.endCash;
    if(r.data.minCash < 0) s -= 50000;
    s -= Math.max(0, (0 - r.data.minCash)) * 2;
    return s;
  }
  results.sort((a,b)=> score(b)-score(a));
  const best = results[0];

  showStep(3);

  document.getElementById("summaryLine").innerText =
    `ì§€ê¸ˆ ê¸°ì¤€, ì œì¼ ëœ ìœ„í—˜í•œ ì„ íƒì€ â†’ ${best.name}`;
  document.getElementById("summarySub").innerText =
    `"ë²„í‹¸ ìˆ˜ ìˆëƒ" ê¸°ì¤€ìœ¼ë¡œ 5ë…„ì„ êµ´ë ¸ì„ ë•Œ ê°€ì¥ ì•ˆì •ì ì¸ ì„ íƒì…ë‹ˆë‹¤.`;

  const d = diagnose(inp);
  document.getElementById("lifeStructureText").innerHTML = d.structureLines.join("<br>");
  
  const bottleneckList = document.getElementById("bottleneckList");
  bottleneckList.innerHTML = "";
  d.bottlenecks.forEach((b, idx) => {
    const li = document.createElement("li");
    li.className = b.level;
    li.innerHTML = `<b>${idx+1}. ${b.title}</b><br>${b.desc}`;
    bottleneckList.appendChild(li);
  });

  const solutions = suggestSolutions(inp, d);
  const solutionText = document.getElementById("solutionText");
  if(solutions.length){
    let html = "";
    solutions.forEach(s => {
      html += `${s.icon} <b>${s.title}</b><br>${s.desc}<br><br>`;
    });
    solutionText.innerHTML = html;
  }else{
    solutionText.innerHTML = "í˜„ì¬ ìƒíƒœê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. ğŸ‘";
  }

  const hint = document.getElementById("experimentHint");
  if(hint && (!hint.innerText || !hint.innerText.trim())){
    hint.innerHTML = `ì˜ˆ: "ì§‘ê°’ -10%" ëˆ„ë¥´ë©´ ì¦‰ì‹œ ì¬ê³„ì‚°ë©ë‹ˆë‹¤.`;
  }

  const warnBox = document.getElementById("warnBox");
  warnBox.innerHTML = "";
  if(best.data.minCash < 0){
    warnBox.innerHTML = `<div class="danger"><b>âš ï¸ ê²½ê³ </b> Â· ì¶”ì²œ ì„ íƒë„ ì¤‘ê°„ì— í†µì¥ì´ ë§ˆì´ë„ˆìŠ¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>`;
  } else if(best.data.minCash < expense*3){
    warnBox.innerHTML = `<div class="notice"><b>âš ï¸ ì£¼ì˜</b> Â· ì¤‘ê°„ì— ëˆì´ ê½¤ ë¹ ë“¯í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>`;
  }

  const box = document.getElementById("resultCards");
  box.innerHTML = "";
  results.forEach((r, idx)=>{
    const dd = r.data;
    const div = document.createElement("div");
    div.className = "result-card" + (idx===0 ? " best" : "");
    div.innerHTML = `
      <b>${r.name} ${idx===0 ? "Â· âœ… ì¶”ì²œ" : ""}</b><br><br>
      ğŸ‘‰ 5ë…„ í›„ í†µì¥: <b>${Math.round(dd.endCash).toLocaleString()}</b> ë§Œì›<br>
      ğŸ‘‰ ìµœì € ì”ê³ : <b>${Math.round(dd.minCash).toLocaleString()}</b> ë§Œì› (${dd.minMonth}ê°œì›”ì°¨)<br>
      ${r.key === 'A' ? `ğŸ‘‰ 5ë…„ ì´ì: <b>${Math.round(dd.totalInterest).toLocaleString()}</b> ë§Œì›` : ''}
    `;
    box.appendChild(div);
  });

  let explain = `DSR í†µê³¼ëŠ” "ì€í–‰ì´ í—ˆìš©í•˜ëŠ” ì›” ìƒí™˜ í•œë„(ì•½ ${Math.floor(maxMonthPay).toLocaleString()}ë§Œì›)" ì•ˆì— ë“¤ì–´ì™”ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. `;
  explain += `ì´ ì‹œë®¬ì€ 5ë…„ ë’¤ ì”ê³ ë¿ ì•„ë‹ˆë¼, ì¤‘ê°„ì— í†µì¥ì´ ë§ˆë¥´ëŠ” ìˆœê°„(ìµœì € ì”ê³ )ì„ ê°™ì´ ë´ì•¼ í˜„ì‹¤ì ì…ë‹ˆë‹¤.`;
  document.getElementById("explainText").innerText = explain;

  const ctx = document.getElementById("cashChart").getContext("2d");
  if(window.__ALK_CHART__) window.__ALK_CHART__.destroy();

  window.__ALK_CHART__ = new Chart(ctx, {
    type:"line",
    data:{
      labels:Array.from({length:60}, (_,i)=> (i+1)+"ê°œì›”"),
      datasets:[
        { label:"ğŸ  ì§€ê¸ˆ ì‚°ë‹¤", data:A.series, borderWidth:2, borderColor:"#2563eb", backgroundColor:"rgba(37,99,235,0.1)" },
        { label:"ğŸ’° ëˆ ë” ëª¨ì•„ì„œ ì‚°ë‹¤", data:B.series, borderWidth:2, borderColor:"#16a34a", backgroundColor:"rgba(22,163,74,0.1)" }
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:"index",intersect:false},
      plugins:{ legend:{ labels:{ color:"#0f172a" } } },
      scales:{
        x:{ ticks:{ color:"#64748b" }, grid:{ color:"rgba(15,23,42,.06)" } },
        y:{ ticks:{ color:"#64748b" }, grid:{ color:"rgba(15,23,42,.06)" } }
      }
    }
  });
  
  if(CURRENT_COMPARISON){
    showComparison(CURRENT_COMPARISON);
  }else{
    showComparison('loanYears');
  }
}

/* =========================================================
   ì´ˆê¸°í™”
========================================================= */
(function init(){
  const ruleInfo = document.getElementById("ruleInfo");
  if(ruleInfo){
    ruleInfo.innerHTML = `0ë‹¨ê³„ì—ì„œ ì§€ì—­ì„ ê³ ë¥´ë©´ LTV/DSRì´ ìë™ ì ìš©ë©ë‹ˆë‹¤.`;
  }
  
  setupRealtimeFeedback();
})();
</script>
<footer class="site-footer">
  <a href="/privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a> |
  <a href="/terms.html">ì´ìš©ì•½ê´€</a>
</footer>

</body>
</html>
